#pragma checksum "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "4374bda5fd391201bd06770550a096983c733301"
// <auto-generated/>
#pragma warning disable 1591
namespace USAIDICANBLAZOR.Pages.Account
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using USAIDICANBLAZOR.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Blazored.Toast;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Blazored.Toast.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using BlazorStrap;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Calendars;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.DropDowns;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Grids;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Inputs;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Navigations;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Buttons;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Notifications;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Popups;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Spinner;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Lists;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Layouts;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Maps;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
using USAIDICANBLAZOR.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
using System.Net;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
using System.Net.Mail;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Components.RouteAttribute("/ForgotPasswordPage")]
    public partial class ForgotPasswordPage : global::Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.AddMarkupContent(0, @"<style>
    body {
        margin: 0px;
        padding: 0px;
        background: url(../image/bg.png);
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-size: cover;
        background-position-y: -68px;
        height: 100%;
        background-color: #000 !important;
        /*font-family: 'Roboto', 'Roboto Condensed' !important;*/
        width: 100%;
        overflow-x: hidden !important;
    }

    .center-screen {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        min-height: 100vh;
        /*width:40%;*/
    }

    h3 {
        color: #FFBF00;
        font-family: Cambria;
    }
    p {
        word-wrap: break-word;
    }
</style>


");
            __builder.OpenElement(1, "div");
            __builder.AddAttribute(2, "class", "center-screen");
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "style", "width:35%;");
            __builder.AddMarkupContent(5, "<h3>Forgot Password</h3>\r\n        ");
            __builder.AddMarkupContent(6, "<p>When you fill in your registered email address, you will be sent instructions on how to reset your password.</p>\r\n        ");
            __builder.OpenElement(7, "input");
            __builder.AddAttribute(8, "type", "email");
            __builder.AddAttribute(9, "placeholder", "email address");
            __builder.AddAttribute(10, "style", "margin-bottom:10px; width:100%;height: 48px; padding:10px;");
            __builder.AddAttribute(11, "value", global::Microsoft.AspNetCore.Components.BindConverter.FormatValue(
#nullable restore
#line 46 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
                                                                      emailAddress

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(12, "onchange", global::Microsoft.AspNetCore.Components.EventCallback.Factory.CreateBinder(this, __value => emailAddress = __value, emailAddress));
            __builder.SetUpdatesAttributeName("value");
            __builder.CloseElement();
#nullable restore
#line 47 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
         if (!string.IsNullOrEmpty(Returnmessage))
        {
            if (Returnmessage.ToLower().Contains("success"))
            {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(13, "p");
            __builder.AddAttribute(14, "class", "badge badge-success");
            __builder.AddAttribute(15, "style", "width:100%; padding:15px; font-family:Cambria;font-size:large;");
#nullable restore
#line 51 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
__builder.AddContent(16, Returnmessage);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 52 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
            }
            else if (Returnmessage.ToLower().Contains("info"))
            {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(17, "p");
            __builder.AddAttribute(18, "class", "badge badge-info");
            __builder.AddAttribute(19, "style", "width:100%; padding:15px; font-family:Cambria;font-size:large;");
#nullable restore
#line 55 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
__builder.AddContent(20, Returnmessage.Replace("info:", ""));

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 56 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
            }
            else
            {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(21, "p");
            __builder.AddAttribute(22, "class", "badge badge-danger");
            __builder.AddAttribute(23, "style", "width:100%; padding:15px; font-family:Cambria;font-size:large;");
#nullable restore
#line 59 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
__builder.AddContent(24, Returnmessage);

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
#nullable restore
#line 60 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
            }
        }

#line default
#line hidden
#nullable disable
            __builder.OpenElement(25, "button");
            __builder.AddAttribute(26, "class", "btn btn-primary btn-block");
            __builder.AddAttribute(27, "style", "margin-bottom: 15px;");
            __builder.AddAttribute(28, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 62 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
                                                                                         ResetPasswordClick

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(29, "Reset Password");
            __builder.CloseElement();
            __builder.AddMarkupContent(30, "\r\n        ");
            __builder.OpenElement(31, "p");
            __builder.AddAttribute(32, "class", "text-center");
            __builder.AddContent(33, "already have an account? ");
            __builder.OpenElement(34, "a");
            __builder.AddAttribute(35, "data-toggle", "tab");
            __builder.AddAttribute(36, "href", "#");
            __builder.AddAttribute(37, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 63 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
                                                                                                 BackToLoginClick

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(38, "login here");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(39, "\r\n        ");
            __builder.OpenElement(40, "p");
            __builder.AddAttribute(41, "class", "text-center");
            __builder.AddContent(42, "new user? ");
            __builder.OpenElement(43, "a");
            __builder.AddAttribute(44, "data-toggle", "tab");
            __builder.AddAttribute(45, "href", "#");
            __builder.AddAttribute(46, "onclick", global::Microsoft.AspNetCore.Components.EventCallback.Factory.Create<global::Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 64 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
                                                                                  RegisterUserClick

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(47, "create new account");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 68 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Account\ForgotPasswordPage.razor"
       
    string emailAddress { get; set; }
    string Returnmessage { get; set; }
    private void BackToLoginClick()
    {
        NavManager.NavigateTo("/", true);
    }
    private void RegisterUserClick()
    {
        NavManager.NavigateTo("ExternalRegistrationPage", true);
    }
    private void ResetPasswordClick()
    {
        //NavManager.NavigateTo("/", true);
        if (string.IsNullOrEmpty(emailAddress))
        {
            Returnmessage = "info: Please enter the email address of the account to reset";
        }
        else
        {
            try
            {
                string url = NavManager.BaseUri;
                using (var db = new USAID_ICANContext())
                {
                    var userexists = db.AspNetUsers.FirstOrDefault(o => o.Email == emailAddress);
                    if (userexists != null)
                    {
                        byte[] b = System.Text.ASCIIEncoding.ASCII.GetBytes(userexists.Id);
                        string encrypted = Convert.ToBase64String(b);
                        string _message = url + "ExternalResetPasswordPage/" + encrypted;

                        using (var message = new MailMessage("donotreply@ibs.co.ug", emailAddress))
                        {
                            message.Subject = "PAU Password Reset";
                            message.Body = "Dear "+ userexists.NameOfUserAccountHolder+ ",<br/><br/>" +
                                    "<p> You recently requested a password reset with us.</p>" +
                                    "<br/> <p>Please click <a href='" + _message + "'>here</a> to be directed to a page to reset your password. Thanks!</p>" +
                                    "<br/> <br/> Regards,<br/><br/> System notfication, <br/> Petrolium Authority of Uganda.<br/><br/>" + DateTime.Now;
                            message.IsBodyHtml = true;
                            using (SmtpClient client = new SmtpClient
                            {
                                EnableSsl = false,
                                //Host = "smtp.gmail.com",
                                Host = "mail.ibs.co.ug",
                                //Port = 587,
                                Port = 25,

                                Credentials = new NetworkCredential("donotreply@ibs.co.ug", "**Root@85")
                            })
                            {
                                //client.EnableSsl = true;
                                client.Send(message);
                            }
                        }
                        Returnmessage = "Success: Reset instructions have been sent to your email.";
                    }
                    else
                    {
                        Returnmessage = "Error: The email address you input doesnot exist.";
                    }
                }
            }
            catch (Exception ex)
            {
                Returnmessage = "Error: something went wrong when processing your request, please try again later or contact the administrator.";
            }
        }
        StateHasChanged();
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
    }
}
#pragma warning restore 1591
