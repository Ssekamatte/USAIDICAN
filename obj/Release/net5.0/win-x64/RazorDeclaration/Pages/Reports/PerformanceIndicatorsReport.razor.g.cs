// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace USAIDICANBLAZOR.Pages.Reports
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using USAIDICANBLAZOR.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Blazored.Toast;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Blazored.Toast.Services;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using BlazorStrap;

#line default
#line hidden
#nullable disable
#nullable restore
#line 13 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Calendars;

#line default
#line hidden
#nullable disable
#nullable restore
#line 15 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.DropDowns;

#line default
#line hidden
#nullable disable
#nullable restore
#line 16 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Grids;

#line default
#line hidden
#nullable disable
#nullable restore
#line 17 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Inputs;

#line default
#line hidden
#nullable disable
#nullable restore
#line 18 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 19 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Navigations;

#line default
#line hidden
#nullable disable
#nullable restore
#line 20 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Buttons;

#line default
#line hidden
#nullable disable
#nullable restore
#line 21 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Notifications;

#line default
#line hidden
#nullable disable
#nullable restore
#line 22 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Popups;

#line default
#line hidden
#nullable disable
#nullable restore
#line 23 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Spinner;

#line default
#line hidden
#nullable disable
#nullable restore
#line 24 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Lists;

#line default
#line hidden
#nullable disable
#nullable restore
#line 25 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Layouts;

#line default
#line hidden
#nullable disable
#nullable restore
#line 26 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\_Imports.razor"
using Syncfusion.Blazor.Maps;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using System.Collections.ObjectModel;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using USAIDICANBLAZOR.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using USAIDICANBLAZOR.Data;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using Microsoft.EntityFrameworkCore;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using System.Collections;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using Syncfusion.XlsIO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using Syncfusion.XlsIO.Implementation;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using Syncfusion.XlsIORenderer;

#line default
#line hidden
#nullable disable
#nullable restore
#line 14 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
using Microsoft.AspNetCore.Hosting;

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Components.RouteAttribute("/PerformanceIndicatorsReport")]
    public partial class PerformanceIndicatorsReport : global::Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(global::Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 99 "D:\MVCProjects\BlazorProject\USAIDICAN\USAIDICANBLAZOR16June2022\USAIDICANBLAZOR\Pages\Reports\PerformanceIndicatorsReport.razor"
       
    #region Toasters
    public static string ToastContent { get; set; }
    SfToast ToastObj;
    SfToast DeleteToastObj;
    private string ToastPosition = "Right";
    private int AlarmTimeout { get; set; } = 120000;
    private List<ToastModel> Toast = new List<ToastModel>
{
        new ToastModel{ Title = "Warning!", Content=ToastContent, CssClass="e-toast-warning", Icon="e-warning toast-icons" },
        new ToastModel{ Title = "Success!", Content=ToastContent, CssClass="e-toast-success", Icon="e-success toast-icons" },
        new ToastModel{ Title = "Error!", Content=ToastContent, CssClass="e-toast-danger", Icon="e-error toast-icons" },
        new ToastModel{ Title = "Information!", Content=ToastContent, CssClass="e-toast-info", Icon="e-info toast-icons" }
    };
    #endregion Toasters

    private SearchPanel InputModel = new SearchPanel();
    private List<View2022ARegions> RegionData { get; set; }
    private List<ViewADistricts> DistrictData { get; set; }
    private List<AYear> FinancialYearData { get; set; }
    private List<OnaAQuarter> QuarterData { get; set; }

    //private List<ViewAYear> YearData { get; set; }
    private List<spPerformanceIndicatorsReportResult> IndicatorsResultsData { get; set; }
    private List<View2022OnaTargetsUpdated> IndicatorsData { get; set; }
    private List<View2022indicatorFilter> IndicatorFilterData { get; set; }
    private List<OnaATargets> IndData { get; set; }

    SfSpinner DownloadingSpinner;
    bool Downloadreport { get; set; } = false;
    string filename { get; set; } = null;
    bool isEnabled { get; set; } = false;
    bool isindicatorEnabled { get; set; } = false;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            await base.OnInitializedAsync();
            if (!userManagement.IsSignedIn())
            {
                Navigation.NavigateTo("/", true);
            }
            else
            {
                InputModel = new SearchPanel();
                using (var db = new SPToCoreContext())
                {
                    RegionData = db.View2022ARegions.OrderBy(o => o.Region).ToList();
                    QuarterData = db.OnaAQuarter.OrderBy(o => o.QuarterId).ToList();
                    DistrictData = db.ViewADistricts.OrderBy(o => o.District).ToList();
                    IndicatorsData = db.View2022OnaTargetsUpdated.OrderBy(o => o.IndicatorId).ToList();
                    IndicatorFilterData = db.View2022indicatorFilter.OrderBy(o => o.IndicatorDescription).ToList();
                    FinancialYearData = db.AYear.OrderBy(o => o.YearId).ToList();
                    IndData = db.OnaATargets.OrderBy(o => o.IndicatorDescription).ToList();


                }
            }
        }
        catch (Exception ex)
        {
            await ToastObj.Show(new ToastModel { Title = "Error!", Content = ex.Message.ToString(), CssClass = "e-toast-danger", Icon = "e-error toast-icons" });
        }
    }
    private void ClearSearchBtnClick()
    {
        InputModel = new SearchPanel();
    }

    private async Task OnSearchSubmit()
    {
        filename = null;
        Downloadreport = true;
        await DownloadingSpinner.ShowAsync();

        try
        {
            using (var db = new SPToCoreContext())
            {
                string RegionId = null;
                string DistrictId = null;
                string FinancialYearId = null;
                string IndicatorId = null;
                string QuarterId = null;

                if (InputModel.RegionId != null && InputModel.RegionId.Length > 0)
                {
                    RegionId = string.Join(",", InputModel.RegionId);
                }

                if (InputModel.DistrictId != null && InputModel.DistrictId.Length > 0)
                {
                    DistrictId = string.Join(",", InputModel.DistrictId);
                }

                if (InputModel.IndicatorId != null && InputModel.IndicatorId.Length > 0)
                {
                    IndicatorId = string.Join(",", InputModel.IndicatorId);
                }

                if (InputModel.Year != null && InputModel.Year.Length > 0)
                {
                    FinancialYearId = string.Join(",", InputModel.Year);
                }

                if (InputModel.QuarterId != null && InputModel.QuarterId.Length > 0)
                {
                    QuarterId = string.Join(",", InputModel.QuarterId);
                }

                var data = await db.spPerformanceIndicatorsReportAsync(RegionId,DistrictId, FinancialYearId, IndicatorId,QuarterId);
                if (data.Count > 0)
                {
                    using (ExcelEngine excelEngine = new ExcelEngine())
                    {
                        IApplication application = excelEngine.Excel;
                        application.DefaultVersion = ExcelVersion.Excel2013;
                        IWorkbook workbook = application.Workbooks.Create(1);
                        IWorksheet worksheet = workbook.Worksheets[0];
                        worksheet.Name = "Performance Indicators Report";

                        #region Styles
                        var headerStyle = workbook.Styles.Add("headerStyle");

                        headerStyle.BeginUpdate();
                        headerStyle.Color = Syncfusion.Drawing.Color.Black;
                        headerStyle.VerticalAlignment = ExcelVAlign.VAlignCenter;
                        headerStyle.Font.Bold = true;
                        headerStyle.Font.FontName = "Arial";
                        headerStyle.Font.Size = 8f;
                        headerStyle.Font.Color = ExcelKnownColors.White;

                        headerStyle.HorizontalAlignment = ExcelHAlign.HAlignCenter;
                        headerStyle.Borders.Color = ExcelKnownColors.White;
                        headerStyle.Borders[ExcelBordersIndex.EdgeLeft].LineStyle = ExcelLineStyle.Thin;
                        headerStyle.Borders[ExcelBordersIndex.EdgeRight].LineStyle = ExcelLineStyle.Thin;
                        headerStyle.Borders[ExcelBordersIndex.EdgeTop].LineStyle = ExcelLineStyle.Thin;

                        headerStyle.WrapText = true;

                        headerStyle.EndUpdate();

                        var Style = workbook.Styles.Add("bodyStyle");

                        Style.BeginUpdate();
                        Style.HorizontalAlignment = ExcelHAlign.HAlignLeft;
                        Style.VerticalAlignment = ExcelVAlign.VAlignTop;
                        Style.Font.Bold = false;
                        Style.Font.FontName = "Arial";
                        Style.Font.Size = 8f;
                        Style.Font.Color = ExcelKnownColors.Black;
                        Style.WrapText = true;
                        Style.Borders.Color = ExcelKnownColors.Black;
                        Style.Borders[ExcelBordersIndex.EdgeLeft].LineStyle = ExcelLineStyle.Thin;
                        Style.Borders[ExcelBordersIndex.EdgeRight].LineStyle = ExcelLineStyle.Thin;
                        Style.Borders[ExcelBordersIndex.EdgeTop].LineStyle = ExcelLineStyle.Thin;
                        Style.Borders[ExcelBordersIndex.EdgeBottom].LineStyle = ExcelLineStyle.Thin;
                        Style.EndUpdate();


                        var CategoryStyle = workbook.Styles.Add("CategoryStyle");

                        CategoryStyle.BeginUpdate();
                        CategoryStyle.HorizontalAlignment = ExcelHAlign.HAlignCenter;
                        CategoryStyle.Color = Syncfusion.Drawing.Color.FromArgb(0, 255, 255);
                        CategoryStyle.Font.Bold = true;
                        CategoryStyle.Font.FontName = "Arial";
                        CategoryStyle.Font.Size = 20f;
                        CategoryStyle.Font.Color = ExcelKnownColors.Brown;
                        CategoryStyle.WrapText = true;
                        CategoryStyle.Borders.Color = ExcelKnownColors.White;
                        CategoryStyle.Borders[ExcelBordersIndex.EdgeLeft].LineStyle = ExcelLineStyle.Thin;
                        CategoryStyle.Borders[ExcelBordersIndex.EdgeRight].LineStyle = ExcelLineStyle.Thin;
                        CategoryStyle.Borders[ExcelBordersIndex.EdgeTop].LineStyle = ExcelLineStyle.Thin;
                        CategoryStyle.Borders[ExcelBordersIndex.EdgeBottom].LineStyle = ExcelLineStyle.Thin;
                        CategoryStyle.EndUpdate();

                        var DivisionStyle = workbook.Styles.Add("DivisionStyle");

                        DivisionStyle.BeginUpdate();
                        DivisionStyle.HorizontalAlignment = ExcelHAlign.HAlignCenter;
                        DivisionStyle.Color = Syncfusion.Drawing.Color.FromArgb(255, 0, 0); //RED
                        DivisionStyle.Font.Bold = true;
                        DivisionStyle.Font.FontName = "Arial";
                        DivisionStyle.Font.Size = 8f;
                        DivisionStyle.Font.Color = ExcelKnownColors.White;
                        DivisionStyle.WrapText = true;
                        DivisionStyle.Borders.Color = ExcelKnownColors.White;
                        DivisionStyle.Borders[ExcelBordersIndex.EdgeLeft].LineStyle = ExcelLineStyle.None;
                        DivisionStyle.Borders[ExcelBordersIndex.EdgeRight].LineStyle = ExcelLineStyle.None;
                        DivisionStyle.Borders[ExcelBordersIndex.EdgeTop].LineStyle = ExcelLineStyle.None;
                        DivisionStyle.Borders[ExcelBordersIndex.EdgeBottom].LineStyle = ExcelLineStyle.None;
                        DivisionStyle.EndUpdate();

                        #endregion

                        int row = 1;
                        worksheet.Range["A" + row].Text = "Performance Indicators Report";
                        worksheet.Range["A" + row + ":J" + row].CellStyle = CategoryStyle;
                        worksheet.Range["A" + row + ":J" + row].CellStyle.HorizontalAlignment = ExcelHAlign.HAlignCenter;
                        worksheet.Range["A" + row + ":J" + row].CellStyle.VerticalAlignment = ExcelVAlign.VAlignCenter;
                        worksheet.Range["A" + row].RowHeight = 30;
                        worksheet.Range["A" + row + ":J" + row].Merge();
                        row++;

                        worksheet.Range["A" + row].Text = "#";
                        worksheet.Range["A" + row].CellStyle = headerStyle;
                        worksheet.Range["A" + row].ColumnWidth = 5;
                        worksheet.Range["A" + row].WrapText = true;

                        worksheet.Range["B" + row].Text = "Financial Year";
                        worksheet.Range["B" + row].CellStyle = headerStyle;
                        worksheet.Range["B" + row].ColumnWidth = 10;
                        worksheet.Range["B" + row].WrapText = true;

                        worksheet.Range["C" + row].Text = "Region";
                        worksheet.Range["C" + row].CellStyle = headerStyle;
                        worksheet.Range["C" + row].ColumnWidth = 10;
                        worksheet.Range["C" + row].WrapText = true;

                        worksheet.Range["D" + row].Text = "District";
                        worksheet.Range["D" + row].CellStyle = headerStyle;
                        worksheet.Range["D" + row].ColumnWidth = 10;
                        worksheet.Range["D" + row].WrapText = true;

                        worksheet.Range["E" + row].Text = "Quarter1";
                        worksheet.Range["E" + row].CellStyle = headerStyle;
                        worksheet.Range["E" + row].ColumnWidth = 10;
                        worksheet.Range["E" + row].WrapText = true;

                        worksheet.Range["F" + row].Text = "Quarter2";
                        worksheet.Range["F" + row].CellStyle = headerStyle;
                        worksheet.Range["F" + row].ColumnWidth = 10;
                        worksheet.Range["F" + row].WrapText = true;

                        worksheet.Range["G" + row].Text = "Quarter3";
                        worksheet.Range["G" + row].CellStyle = headerStyle;
                        worksheet.Range["G" + row].ColumnWidth = 10;
                        worksheet.Range["G" + row].WrapText = true;

                        worksheet.Range["H" + row].Text = "Quarter4";
                        worksheet.Range["H" + row].CellStyle = headerStyle;
                        worksheet.Range["H" + row].ColumnWidth = 10;
                        worksheet.Range["H" + row].WrapText = true;

                        worksheet.Range["I" + row].Text = "Target";
                        worksheet.Range["I" + row].CellStyle = headerStyle;
                        worksheet.Range["I" + row].ColumnWidth = 10;
                        worksheet.Range["I" + row].WrapText = true;

                        worksheet.Range["J" + row].Text = "% Achievement";
                        worksheet.Range["J" + row].CellStyle = headerStyle;
                        worksheet.Range["J" + row].ColumnWidth = 10;
                        worksheet.Range["J" + row].WrapText = true;

                        row++;

                        int count = 1;
                        var vb = IndicatorsData.Select(o => new { o.IndicatorId, o.IndicatorDescription }).Distinct().ToList();

                        foreach (var x in vb)
                        {
                            var IndData = data.Where(o => o.IndicatorId == x.IndicatorId).ToList();
                            if (IndData.Count > 0)
                            {
                                #region Header
                                worksheet.Range["A" + row].Text = "INDICATOR: " + x.IndicatorDescription;
                                worksheet.Range["A" + row + ":J" + row].CellStyle = DivisionStyle;
                                worksheet.Range["A" + row + ":J" + row].Merge();
                                worksheet.Range["A" + row + ":J" + row].WrapText = true;
                                worksheet.Range["A" + row + ":J" + row].RowHeight=20;
                                worksheet.Range["A" + row].CellStyle.HorizontalAlignment = ExcelHAlign.HAlignLeft;

                                #endregion
                                row++;

                                foreach (var n in IndData)
                                {
                                    worksheet.Range["A" + row].Text = count.ToString();

                                    if (n.Year.HasValue)
                                    {
                                        worksheet.Range["B" + row].Number = n.Year.Value;
                                    }

                                    worksheet.Range["C" + row].Text = n.Region;

                                    worksheet.Range["D" + row].Text = n.District;

                                    worksheet.Range["E" + row].Number = n.Quarter1;

                                    worksheet.Range["F" + row].Number = n.Quarter2;

                                    worksheet.Range["G" + row].Number = n.Quarter3;

                                    worksheet.Range["H" + row].Number = n.Quarter4;

                                    if (n.Target.HasValue)
                                    {
                                        worksheet.Range["I" + row].Number = n.Target.Value;
                                    }

                                    worksheet.Range["J" + row].Number = n.PercentageAchievement;

                                    //double Achievement = 0;
                                    //if ((n.Target.HasValue && n.Actual.HasValue))
                                    //{
                                    //    var a = Convert.ToDouble(n.Target) / Convert.ToDouble(n.Actual);
                                    //    Achievement = Math.Round((a) * 100,1);

                                    //    worksheet.Range["H" + row].Number = Achievement;
                                    //}

                                    row += 1;
                                    count++;
                                }
                            }
                        }

                        MemoryStream ms = new MemoryStream();
                        // Save and close the document.
                        workbook.SaveAs(ms);
                        //Reset the memory stream position.
                        ms.Position = 0;
                        string _filename = "Performance Indicators Report.xlsx";
                        var path = hostEnvironment.WebRootPath + $@"\DownloadReport\{_filename}";
                        if (!System.IO.File.Exists(path))
                        {
                            FileStream filestream = new FileStream(path, FileMode.Create, FileAccess.ReadWrite);
                            ms.WriteTo(filestream);
                            await Task.Delay(15000);
                            filestream.Dispose();
                        }
                        else
                        {
                            System.IO.File.Delete(path);
                            FileStream filestream = new FileStream(path, FileMode.Create, FileAccess.ReadWrite);
                            ms.WriteTo(filestream);
                            await Task.Delay(15000);
                            filestream.Dispose();
                        }
                        filename = _filename;
                        await JS.SaveAs("Performance Indicators Report.xlsx", ms.ToArray());
                        ms.Dispose();
                        workbook.Close();
                        InputModel.Response = "Report Downloaded Successfully";

                    }
                }
                else
                {
                    InputModel.Response = "There were no records found that match the given search parameters";
                    Downloadreport = false;
                    StateHasChanged();
                }
            }
        }
        catch (Exception ex)
        {
            await ToastObj.Show(new ToastModel { Title = "Error!", Content = ex.Message.ToString(), CssClass = "e-toast-danger", Icon = "e-error toast-icons" });

        }
        finally
        {
            Downloadreport = false;
            await DownloadingSpinner.HideAsync();
            await Task.CompletedTask;
            StateHasChanged();
        }
    }

    public void OnRegionChange(Syncfusion.Blazor.DropDowns.MultiSelectChangeEventArgs<int?[]> args)
    {
        if (args.Value != null)
        {
            using (var db = new USAID_ICANContext())
            {
                DistrictData = db.ViewADistricts.Where(o => args.Value.Any(a => a == o.RegionId) == true).ToList();
                isEnabled = true;
            }
        }
    }

    public void OnIndicatorChange(Syncfusion.Blazor.DropDowns.MultiSelectChangeEventArgs<int?[]> args)
    {
        if (args.Value != null)
        {
            using (var db = new USAID_ICANContext())
            {
                IndicatorFilterData = db.View2022indicatorFilter.Where(o => args.Value.Any(a => a ==o.FinancialYearId) == true).ToList();
                isindicatorEnabled = true;
            }
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IWebHostEnvironment hostEnvironment { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Microsoft.JSInterop.IJSRuntime JS { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager Navigation { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private UserManagement userManagement { get; set; }
    }
}
#pragma warning restore 1591
